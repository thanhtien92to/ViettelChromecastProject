"use strict";var castReceiverPlayer=castReceiverPlayer||{};var attchedvideoClassName='.video';var overlayClassName='.media-info-show-part';var watermarkClassName='.watermark';var mediaInformationClassName='.media-info';var mediaTextClassName='.media-tex';var mediaArtworkClassName='.media-artwork';var mediaTitleClassName='.media-title';var mediaSubtitleClassName='.media-subtitle';var mediaArtWorkQueueClassName='.media-artwork-queue-insert';var mediaTitleQueueClassName='.media-title-queue-insert';var mediaSubtitleQueueClassName='.media-subtitle-queue-insert';var previewModeInformationClassName='.preview-info';var previewModeArtworkClassName='.preview-artwork';var previewModeTextClassName='.preview-text';var previewModeTimerClassName='.preview-timer';var previewModeTimerStartsClassName='.preview-timer-starts';var previewModeTimerCountdownClassName='.preview-timer-countdown';var previewModeTimerSecClassName='.preview-timer-sec';var previewModeTitleClassName='.preview-title';var previewModeSubtitleClassName='.preview-subtitle';var controlsClassName='.controls';var controlsPlayPauseClassName='.controls-play-pause';var controlsCurrentTimeClassName='.controls-cur-time';var controlsTotalTimeClassName='.controls-total-time';var controlsProgressClassName='.controls-progress';var controlsProgressInnerClassName='.controls-progress-inner';var controlsProgressThumbClassName='.controls-progress-thumb';var vodTitle='.vod-title';var vodDirector='.vod-director';var vodStar='.vod-star';var vodSubtitle='.vod-subtitle';var vodPoster='.vod-poster';var domElementArtributePreviewMode='preview';var domElementArtributeType='type';var domElementArtributeState='state';var domElementArtributeLive='live';var domElementArtributeLang='lang';castReceiverPlayer.ChromecastPlayer=function(domElement){var vidType='video/mp4';var codType='avc1.42E01E, mp4a.40.2';var vid=document.createElement('video');var isSupp=vid.canPlayType(vidType+';codecs="'+codType+'"');if(isSupp==""){isSupp="No"}
console.log('Supported MP4? : '+isSupp);this.debug_=castReceiverPlayer.ENABLE_DEBUG_;if(this.debug_){cast.player.api.setLoggerLevel(cast.player.api.LoggerLevel.DEBUG);cast.receiver.logger.setLevelValue(cast.receiver.LoggerLevel.DEBUG)}
this.domElement_=domElement;var userLang=navigator.language||navigator.userLanguage;if(userLang=='vi'){this.domElement_.setAttribute(domElementArtributeLang,'vi');document.getElementById("vodDirectorTag").innerHTML="Đạo Diễn";document.getElementById("vodStarTag").innerHTML="Diễn Viên"}
else{this.domElement_.setAttribute(domElementArtributeLang,'vi');document.getElementById("vodDirectorTag").innerHTML="Đạo Diễn";document.getElementById("vodStarTag").innerHTML="Diễn Viên"}
this.mediaType_;this.setMediaType_(castReceiverPlayer.Type.UNKNOWN,!1);this.playerState_;this.lastStateTransitionTime_=0;this.setPlayerState_(castReceiverPlayer.State.LAUNCHING,!1);this.burnInPreventionIntervalId_;this.idleTimerId_;this.curAppState_;this.progressBarInnerElement_=this.getElementByClass_(controlsProgressInnerClassName);this.progressBarThumbElement_=this.getElementByClass_(controlsProgressThumbClassName);this.curTimeElement_=this.getElementByClass_(controlsCurrentTimeClassName);this.totalTimeElement_=this.getElementByClass_(controlsTotalTimeClassName);this.previewModeTimerElement_=this.getElementByClass_(previewModeTimerCountdownClassName);this.bufferingHandler_=this.onBuffering_.bind(this);this.player_=null;this.preloadPlayer_=null;this.textTrackType_=null;this.playerAutoPlay_=!1;this.displayPreviewMode_=!1;this.deferredPlayCallbackId_=null;this.playerReady_=!1;this.metadataLoaded_=!1;this.loadedMediaInfor_=null;this.loadedLiveDuration_=Infinity;this.mediaElement_=(this.domElement_.querySelector(attchedvideoClassName));this.mediaElement_.addEventListener('error',this.onError_.bind(this),!1);this.mediaElement_.addEventListener('playing',this.onPlaying_.bind(this),!1);this.mediaElement_.addEventListener('pause',this.onPause_.bind(this),!1);this.mediaElement_.addEventListener('ended',this.onEnded_.bind(this),!1);this.mediaElement_.addEventListener('abort',this.onAbort_.bind(this),!1);this.mediaElement_.addEventListener('timeupdate',this.onProgress_.bind(this),!1);this.mediaElement_.addEventListener('seeking',this.onSeekStart_.bind(this),!1);this.mediaElement_.addEventListener('seeked',this.onSeekEnd_.bind(this),!1);this.receiverManager_=cast.receiver.CastReceiverManager.getInstance();this.receiverManager_.onReady=this.onReady_.bind(this);this.receiverManager_.onSenderDisconnected=this.onSenderDisconnected_.bind(this);this.receiverManager_.onVisibilityChanged=this.onVisibilityChanged_.bind(this);this.receiverManager_.setApplicationState(castReceiverPlayer.getApplicationState_());this.mediaManager_=new cast.receiver.MediaManager(this.mediaElement_);this.onLoadOrig_=this.mediaManager_.onLoad.bind(this.mediaManager_);this.mediaManager_.onLoad=this.onLoad_.bind(this);this.onEditTracksInfoOrig_=this.mediaManager_.onEditTracksInfo.bind(this.mediaManager_);this.mediaManager_.onEditTracksInfo=this.onEditTracksInfo_.bind(this);this.onMetadataLoadedOrig_=this.mediaManager_.onMetadataLoaded.bind(this.mediaManager_);this.mediaManager_.onMetadataLoaded=this.onMetadataLoaded_.bind(this);this.onStopOrig_=this.mediaManager_.onStop.bind(this.mediaManager_);this.mediaManager_.onStop=this.onStop_.bind(this);this.onLoadMetadataErrorOrig_=this.mediaManager_.onLoadMetadataError.bind(this.mediaManager_);this.mediaManager_.onLoadMetadataError=this.onLoadMetadataError_.bind(this);this.onErrorOrig_=this.mediaManager_.onError.bind(this.mediaManager_);this.mediaManager_.onError=this.onError_.bind(this);this.onQueueEndedOrig_=this.mediaManager_.onQueueEnded.bind(this.mediaManager_);this.mediaManager_.onQueueEnded=this.onQueueEnded_.bind(this);this.onQueueInsertOrig_=this.mediaManager_.onQueueInsert.bind(this.mediaManager_);this.mediaManager_.onQueueInsert=this.onQueueInsert_.bind(this);this.onQueueLoadOrig_=this.mediaManager_.onQueueLoad.bind(this.mediaManager_);this.mediaManager_.onQueueLoad=this.onQueueLoad_.bind(this);this.onQueueRemoveOrig_=this.mediaManager_.onQueueRemove.bind(this.mediaManager_);this.mediaManager_.onQueueRemove=this.onQueueRemove_.bind(this);this.onQueueReorderOrig_=this.mediaManager_.onQueueReorder.bind(this.mediaManager_);this.mediaManager_.onQueueReorder=this.onQueueReorder_.bind(this);this.onQueueUpdateOrig_=this.mediaManager_.onQueueUpdate.bind(this.mediaManager_);this.mediaManager_.onQueueUpdate=this.onQueueUpdate_.bind(this);this.mediaManager_.customizedStatusCallback=this.customizedStatusCallback_.bind(this);this.mediaManager_.onPreload=this.onPreload_.bind(this);this.mediaManager_.onCancelPreload=this.onCancelPreload_.bind(this);/* (End)Init MediaManager*/};castReceiverPlayer.ChromecastPlayer.prototype.getMediaElement=function(){return this.mediaElement_};castReceiverPlayer.ChromecastPlayer.prototype.getMediaManager=function(){return this.mediaManager_};castReceiverPlayer.ChromecastPlayer.prototype.getPlayer=function(){return this.player_};castReceiverPlayer.ChromecastPlayer.prototype.start=function(){this.receiverManager_.start()};castReceiverPlayer.ChromecastPlayer.prototype.onError_=function(error){console.log('Player Event --- onError');var self=this;castReceiverPlayer.transition_(self.domElement_,castReceiverPlayer.TRANSITION_DURATION_,function(){self.setPlayerState_(castReceiverPlayer.State.IDLE,!1);self.onErrorOrig_(error)})};castReceiverPlayer.ChromecastPlayer.prototype.onPlaying_=function(){console.log('Player Event --- onEvent');this.cancelDeferredPlay_('media is already playing');var isAudio=this.mediaType_==castReceiverPlayer.Type.AUDIO;var isLoading=this.playerState_==castReceiverPlayer.State.LOADING;var crossfade=isLoading&&!isAudio;this.setPlayerState_(castReceiverPlayer.State.PLAYING,!1)};castReceiverPlayer.ChromecastPlayer.prototype.onPause_=function(){console.log('Player Event --- onPause');this.cancelDeferredPlay_('media is paused');var isIdle=this.playerState_===castReceiverPlayer.State.IDLE;var isDone=this.mediaElement_.currentTime===this.mediaElement_.duration;var isUnderflow=this.player_&&this.player_.getState()['underflow'];if(isUnderflow){console.log('isUnderflow');this.setPlayerState_(castReceiverPlayer.State.BUFFERING,!1);this.mediaManager_.broadcastStatus(!1)}else if(!isIdle&&!isDone){this.setPlayerState_(castReceiverPlayer.State.PAUSED,!1)}
this.updateProgress_()};castReceiverPlayer.ChromecastPlayer.prototype.onEnded_=function(){console.log('Player Event --- onEnded');this.setPlayerState_(castReceiverPlayer.State.IDLE,!1);this.hidePreviewMode_()};castReceiverPlayer.ChromecastPlayer.prototype.onAbort_=function(){console.log('Player Event --- onAbort');this.setPlayerState_(castReceiverPlayer.State.IDLE,!1);this.hidePreviewMode_()};castReceiverPlayer.ChromecastPlayer.prototype.onProgress_=function(){console.log('Player Event --- onProgress');if(this.playerState_===castReceiverPlayer.State.BUFFERING||this.playerState_===castReceiverPlayer.State.LOADING){this.setPlayerState_(castReceiverPlayer.State.PLAYING,!1)}
this.updateProgress_()};castReceiverPlayer.ChromecastPlayer.prototype.onSeekStart_=function(){console.log('Player Event --- onSeekStart');clearTimeout(this.seekingTimeoutId_);this.domElement_.classList.add('seeking')};castReceiverPlayer.ChromecastPlayer.prototype.onSeekEnd_=function(){console.log('Player Event --- onSeekEnd');clearTimeout(this.seekingTimeoutId_);this.seekingTimeoutId_=castReceiverPlayer.addClassWithTimeout_(this.domElement_,'seeking',100)};castReceiverPlayer.ChromecastPlayer.prototype.onReady_=function(){console.log('CastReceiverManager --- onReady');this.setPlayerState_(castReceiverPlayer.State.IDLE,!1)};castReceiverPlayer.ChromecastPlayer.prototype.onSenderDisconnected_=function(event){console.log('CastReceiverManager --- onSenderDisconnected');console.log('onSenderDisconnected: Event --- '+JSON.stringify(event));if(this.receiverManager_.getSenders().length===0&&event.reason===cast.receiver.system.DisconnectReason.REQUESTED_BY_SENDER){this.receiverManager_.stop()}
console.log(' (End) CastReceiverManager --- onSenderDisconnected')};castReceiverPlayer.ChromecastPlayer.prototype.onVisibilityChanged_=function(event){console.log('CastReceiverManager --- onVisibilityChanged');if(!event.isVisible){this.mediaElement_.pause();this.mediaManager_.broadcastStatus(!1)}};castReceiverPlayer.getApplicationState_=function(opt_media){if(opt_media&&opt_media.metadata&&opt_media.metadata.title){return 'Now Casting: '+opt_media.metadata.title}else if(opt_media){return 'Now Casting'}else{return 'Ready To Cast'}};castReceiverPlayer.ChromecastPlayer.prototype.onLoad_=function(event){console.log('MediaManager Event --- onLoad');console.log('onLoad --- event: '+JSON.stringify(event));this.loadedMediaInfor_=event;this.loadedLiveDuration_=event.data.media.duration;console.log('loadedLiveDuration_ = '+this.loadedLiveDuration_);this.cancelDeferredPlay_('new media is loaded');this.load(new cast.receiver.MediaManager.LoadInfo((event.data),event.senderId));console.log(' (End) MediaManager Event --- onLoad')};castReceiverPlayer.ChromecastPlayer.prototype.onEditTracksInfo_=function(event){console.log('MediaManager Event --- onEditTracksInfo');this.onEditTracksInfoOrig_(event);if(!event.data||!event.data.activeTrackIds||!this.textTrackType_){return}
var mediaInformation=this.mediaManager_.getMediaInformation()||{};var type=this.textTrackType_;if(type==castReceiverPlayer.TextTrackType.SIDE_LOADED_TTML){if(this.player_){this.player_.enableCaptions(!1,cast.player.api.CaptionsType.TTML)}
this.processTtmlCues_(event.data.activeTrackIds,mediaInformation.tracks||[])}else if(type==castReceiverPlayer.TextTrackType.EMBEDDED){this.player_.enableCaptions(!1);this.processInBandTracks_(event.data.activeTrackIds);this.player_.enableCaptions(!0)}};castReceiverPlayer.ChromecastPlayer.prototype.onMetadataLoaded_=function(info){console.log('MediaManager Event ---  onMetadataLoaded');this.onLoadSuccess_();this.readSideLoadedTextTrackType_(info);if(this.textTrackType_==castReceiverPlayer.TextTrackType.SIDE_LOADED_TTML&&info.message&&info.message.activeTrackIds&&info.message.media&&info.message.media.tracks){this.processTtmlCues_(info.message.activeTrackIds,info.message.media.tracks)}else if(!this.textTrackType_){this.maybeLoadEmbeddedTracksMetadata_(info)}
this.metadataLoaded_=!0;this.maybeSendLoadCompleted_(info);console.log(' (End) MediaManager Event ---  onMetadataLoaded')};castReceiverPlayer.ChromecastPlayer.prototype.onStop_=function(event){console.log('MediaManager Event --- onStop');this.cancelDeferredPlay_('media is stopped');var self=this;castReceiverPlayer.transition_(self.domElement_,castReceiverPlayer.TRANSITION_DURATION_,function(){self.setPlayerState_(castReceiverPlayer.State.IDLE,!1);self.onStopOrig_(event)})};castReceiverPlayer.ChromecastPlayer.prototype.onLoadMetadataError_=function(event){console.log('MediaManager Event --- onLoadMetadataError_');var self=this;castReceiverPlayer.transition_(self.domElement_,castReceiverPlayer.TRANSITION_DURATION_,function(){self.setPlayerState_(castReceiverPlayer.State.IDLE,!1);self.onLoadMetadataErrorOrig_(event)})};castReceiverPlayer.ChromecastPlayer.prototype.customizedStatusCallback_=function(mediaStatus){console.log('customizedStatusCallback_: playerState='+mediaStatus.playerState+', this.playerState_='+this.playerState_);if(mediaStatus.playerState===cast.receiver.media.PlayerState.PAUSED&&this.playerState_===castReceiverPlayer.State.BUFFERING){mediaStatus.playerState=cast.receiver.media.PlayerState.BUFFERING}
return mediaStatus};castReceiverPlayer.ChromecastPlayer.prototype.onPreload_=function(event){console.log('MediaManager Event --- onPreload');var loadRequestData=(event.data);return this.preload(loadRequestData.media)};castReceiverPlayer.ChromecastPlayer.prototype.onCancelPreload_=function(event){console.log('MediaManager Event --- onCancelPreload_');this.hidePreviewMode_();return!0};castReceiverPlayer.ChromecastPlayer.prototype.onQueueEnded_=function(event){console.log('MediaManager Event --- onQueueEnded_');console.log('onQueueEnded_ (event) event : '+JSON.stringify(event));var self=this;self.onQueueEndedOrig_(event)};castReceiverPlayer.ChromecastPlayer.prototype.onQueueInsert_=function(event){console.log('MediaManager Event --- onQueueInsert_');console.log('onQueueInsert_ (event) event : '+JSON.stringify(event));console.log('loadMetadata_');if(!castReceiverPlayer.isCastForAudioDevice_()){var media=event.data.items[0].media;if(media){var metadata=media.metadata||{};var titleElement=this.domElement_.querySelector(mediaTitleQueueClassName);castReceiverPlayer.setInnerText_(titleElement,metadata.title);var subtitleElement=this.domElement_.querySelector(mediaSubtitleQueueClassName);castReceiverPlayer.setInnerText_(subtitleElement,'Add to queue');var artwork=castReceiverPlayer.getMediaImageUrl_(media);if(artwork){var artworkElement=this.domElement_.querySelector(mediaArtWorkQueueClassName);castReceiverPlayer.setBackgroundImage_(artworkElement,artwork)}}}
castReceiverPlayer.addClassWithTimeout_(this.domElement_,'queue-event',5000);var self=this;self.onQueueInsertOrig_(event)};castReceiverPlayer.ChromecastPlayer.prototype.onQueueLoad_=function(event){console.log('MediaManager Event --- onQueueLoad_');console.log('onQueueLoad_ (event) event : '+JSON.stringify(event));var self=this;self.onQueueLoadOrig_(event)};castReceiverPlayer.ChromecastPlayer.prototype.onQueueRemove_=function(event){console.log('MediaManager Event --- onQueueRemove_');console.log('onQueueRemove_ (event) event : '+JSON.stringify(event));var self=this;self.onQueueRemoveOrig_(event)};castReceiverPlayer.ChromecastPlayer.prototype.onQueueReorder_=function(event){console.log('MediaManager Event --- onQueueReorder_');console.log('onQueueReorder_ (event) event : '+JSON.stringify(event));var self=this;self.onQueueReorderOrig_(event)};castReceiverPlayer.ChromecastPlayer.prototype.onQueueUpdate_=function(event){console.log('MediaManager Event ---onQueueUpdate_');console.log('onQueueUpdate_ (event) event : '+JSON.stringify(event));var self=this;self.onQueueUpdateOrig_(event)};castReceiverPlayer.IDLE_TIMEOUT={LAUNCHING:6*60*1000,LOADING:2*60*1000,PAUSED:10*60*1000,DONE:6*60*1000,IDLE:6*60*1000};castReceiverPlayer.Type={AUDIO:'audio',VIDEO:'video',UNKNOWN:'unknown'};castReceiverPlayer.TextTrackType={SIDE_LOADED_TTML:'ttml',SIDE_LOADED_VTT:'vtt',SIDE_LOADED_UNSUPPORTED:'unsupported',EMBEDDED:'embedded'};castReceiverPlayer.CaptionsMimeType={TTML:'application/ttml+xml',VTT:'text/vtt'};castReceiverPlayer.TrackType={AUDIO:'audio',VIDEO:'video',TEXT:'text'};castReceiverPlayer.State={LAUNCHING:'launching',LOADING:'loading',BUFFERING:'buffering',PLAYING:'playing',PAUSED:'paused',DONE:'done',IDLE:'idle'};castReceiverPlayer.BURN_IN_TIMEOUT=30*1000;castReceiverPlayer.MEDIA_INFO_DURATION_=3*1000;castReceiverPlayer.TRANSITION_DURATION_=0.5;castReceiverPlayer.ENABLE_DEBUG_=!0;castReceiverPlayer.DISABLE_DEBUG_=!1;castReceiverPlayer.ChromecastPlayer.prototype.preload=function(mediaInformation){console.log('function - preload');if(castReceiverPlayer.canDisplayPreview_(mediaInformation||{})){this.showPreviewMode_(mediaInformation);return!0}
if(!castReceiverPlayer.supportsPreload_(mediaInformation||{})){console.log('preload - no supportsPreload_');return!1}
if(this.preloadPlayer_){this.preloadPlayer_.unload();this.preloadPlayer_=null}
var couldPreload=this.preloadVideo_(mediaInformation);if(couldPreload){this.showPreviewMode_(mediaInformation)}
console.log('preload - couldPreload='+couldPreload);console.log('(end) function - preload');return couldPreload};castReceiverPlayer.ChromecastPlayer.prototype.showPreviewModeMetadata=function(show){this.domElement_.setAttribute(domElementArtributePreviewMode,show.toString())};castReceiverPlayer.ChromecastPlayer.prototype.showPreviewMode_=function(mediaInformation){this.displayPreviewMode_=!0;this.loadPreviewModeMetadata_(mediaInformation);this.showPreviewModeMetadata(!0)};castReceiverPlayer.ChromecastPlayer.prototype.hidePreviewMode_=function(){this.showPreviewModeMetadata(!1);this.displayPreviewMode_=!1};castReceiverPlayer.ChromecastPlayer.prototype.preloadVideo_=function(mediaInformation){console.log('preloadVideo_');var self=this;var url=mediaInformation.contentId;var protocolFunc=castReceiverPlayer.getProtocolFunction_(mediaInformation);if(!protocolFunc){console.log('No protocol found for preload');return!1}
var host=new cast.player.api.Host({'url':url,'mediaElement':self.mediaElement_});host.updateLicenseRequestInfo=function(requestInfo){console.log('updateLicenseRequestInfo --- requestInfo : '+JSON.stringify(requestInfo));requestInfo.headers={};requestInfo.headers.AUTHORIZATION='BASIC QWx0aWNhc3Q6RFJNU2VydmljZQ==';requestInfo.headers.host='sec.viettelttv.com.vn'};host.onError=function(){self.preloadPlayer_.unload();self.preloadPlayer_=null;self.showPreviewModeMetadata(!1);self.displayPreviewMode_=!1;console.log('Error during preload')};self.preloadPlayer_=new cast.player.api.Player(host);self.preloadPlayer_.preload(protocolFunc(host));return!0};castReceiverPlayer.ChromecastPlayer.prototype.load=function(info){console.log('load cast.receiver.MediaManager.LoadInfo object');clearTimeout(this.idleTimerId_);var self=this;var media=info.message.media||{};var contentType=media.contentType;var playerType=castReceiverPlayer.getType_(media);var isLiveStream=media.streamType===cast.receiver.media.StreamType.LIVE;isLiveStream=isLiveStream||(media.metadata.CHROME_MEDIA_TYPE=="CAST_CATCHUP");if(!media.contentId){console.log('Load failed --- no content');self.onLoadMetadataError_(info)}else if(playerType===castReceiverPlayer.Type.UNKNOWN){console.log('Load failed: unknown content type: '+contentType);self.onLoadMetadataError_(info)}else{console.log('Loading: '+playerType);self.resetMediaElement_();self.setMediaType_(playerType,isLiveStream);var preloaded=!1;switch(playerType){case castReceiverPlayer.Type.AUDIO:self.loadAudio_(info);break;case castReceiverPlayer.Type.VIDEO:preloaded=self.loadVideo_(info);break}
self.playerReady_=!1;self.metadataLoaded_=!1;self.loadMetadata_(media);self.showPreviewModeMetadata(!1);self.displayPreviewMode_=!1;castReceiverPlayer.preload_(media,function(){console.log('preloaded='+preloaded);if(preloaded){self.setPlayerState_(castReceiverPlayer.State.PLAYING,!1);self.playerReady_=!0;self.maybeSendLoadCompleted_(info);self.deferPlay_(0);self.playerAutoPlay_=!1}else{castReceiverPlayer.transition_(self.domElement_,castReceiverPlayer.TRANSITION_DURATION_,function(){self.setPlayerState_(castReceiverPlayer.State.LOADING,!1);self.playerReady_=!0;self.maybeSendLoadCompleted_(info);if(self.playerAutoPlay_){self.deferPlay_(castReceiverPlayer.MEDIA_INFO_DURATION_);self.playerAutoPlay_=!1}})}})}};castReceiverPlayer.ChromecastPlayer.prototype.maybeSendLoadCompleted_=function(info){if(!this.playerReady_){console.log('Deferring load response, player not ready')}else if(!this.metadataLoaded_){console.log('Deferring load response, loadedmetadata event not received')}else{this.onMetadataLoadedOrig_(info);console.log('Sent load response, player is ready and metadata loaded')}};castReceiverPlayer.ChromecastPlayer.prototype.resetMediaElement_=function(){console.log('resetMediaElement_');if(this.player_){this.player_.unload();this.player_=null}
this.textTrackType_=null};castReceiverPlayer.ChromecastPlayer.prototype.loadMetadata_=function(media){console.log('loadMetadata_');if(!castReceiverPlayer.isCastForAudioDevice_()){var metadata=media.metadata||{};var titleElement=this.domElement_.querySelector(mediaTitleClassName);castReceiverPlayer.setInnerText_(titleElement,metadata.title);document.getElementById("vodTitle").innerHTML=metadata.title;document.getElementById("vodSubtitle").innerHTML=metadata.subtitle;if(metadata.CAST_INFO_DIRECTOR!=undefined){document.getElementById("vodDirector").innerHTML=metadata.CAST_INFO_DIRECTOR}
else{var userLang=navigator.language||navigator.userLanguage;if(userLang=='vi'){document.getElementById("vodDirector").innerHTML='Đang cập nhật'}
else{document.getElementById("vodDirector").innerHTML='Updating'}}
if(metadata.CAST_INFO_STAR!=undefined){document.getElementById("vodStar").innerHTML=metadata.CAST_INFO_STAR}
else{var userLang=navigator.language||navigator.userLanguage;if(userLang=='vi'){document.getElementById("vodStar").innerHTML='Đang cập nhật'}
else{document.getElementById("vodStar").innerHTML='Updating'}}
if(metadata.CAST_INFO_LIKES!=undefined){document.getElementById("vodLikesNumber").innerHTML=metadata.CAST_INFO_LIKES}
else{document.getElementById("vodLikesNumber").innerHTML='0'}
if(metadata.CAST_INFO_PRODUCTION_YEAR!=undefined){document.getElementById("vodYear").innerHTML=metadata.CAST_INFO_PRODUCTION_YEAR}
else{document.getElementById("vodYear").innerHTML='0000'}
if(metadata.CAST_INFO_GENRES!=undefined){document.getElementById("vodGenres").innerHTML=metadata.CAST_INFO_GENRES}
else{document.getElementById("vodGenres").innerHTML=''}
if(metadata.CAST_INFO_HOT!=undefined){if(metadata.CAST_INFO_HOT==1){document.getElementById("vodHotTypeIcon").src='image/icon_new.png';document.getElementById("vodHotTypeIcon").visibility='visible'}
else if(metadata.CAST_INFO_HOT==2){document.getElementById("vodHotTypeIcon").src='image/icon_hot.png';document.getElementById("vodHotTypeIcon").visibility='visible'}
else{document.getElementById("vodHotTypeIcon").visibility='hidden'}}
else{document.getElementById("vodHotTypeIcon").visibility='hidden'}
var subtitleElement=this.domElement_.querySelector(mediaSubtitleClassName);castReceiverPlayer.setInnerText_(subtitleElement,metadata.subtitle);var artwork=castReceiverPlayer.getMediaImageUrl_(media);if(artwork){var artworkElement=this.domElement_.querySelector(mediaArtworkClassName);castReceiverPlayer.setBackgroundImage_(artworkElement,artwork);document.getElementById("vodPoster").src=artwork}}};castReceiverPlayer.ChromecastPlayer.prototype.loadPreviewModeMetadata_=function(media){console.log('loadPreviewModeMetadata_');if(!castReceiverPlayer.isCastForAudioDevice_()){var metadata=media.metadata||{};var titleElement=this.domElement_.querySelector(previewModeTitleClassName);castReceiverPlayer.setInnerText_(titleElement,metadata.title);var subtitleElement=this.domElement_.querySelector(previewModeSubtitleClassName);castReceiverPlayer.setInnerText_(subtitleElement,metadata.subtitle);var artwork=castReceiverPlayer.getMediaImageUrl_(media);if(artwork){var artworkElement=this.domElement_.querySelector(previewModeArtworkClassName);castReceiverPlayer.setBackgroundImage_(artworkElement,artwork)}}};castReceiverPlayer.ChromecastPlayer.prototype.letPlayerHandleAutoPlay_=function(info){console.log('letPlayerHandleAutoPlay_: '+info.message.autoplay);var autoplay=info.message.autoplay;info.message.autoplay=!1;this.mediaElement_.autoplay=!1;this.playerAutoPlay_=autoplay==undefined?!0:autoplay};castReceiverPlayer.ChromecastPlayer.prototype.loadAudio_=function(info){console.log('loadAudio_');this.letPlayerHandleAutoPlay_(info);this.loadDefault_(info)};castReceiverPlayer.ChromecastPlayer.prototype.loadVideo_=function(info){console.log('loadVideo_');var self=this;var protocolFunc=null;var url=info.message.media.contentId;var protocolFunc=castReceiverPlayer.getProtocolFunction_(info.message.media);var wasPreloaded=!1;this.letPlayerHandleAutoPlay_(info);if(!protocolFunc){console.log('loadVideo_: using MediaElement');this.mediaElement_.addEventListener('stalled',this.bufferingHandler_,!1);this.mediaElement_.addEventListener('waiting',this.bufferingHandler_,!1)}else{console.log('loadVideo_: using Media Player Library');this.mediaElement_.removeEventListener('stalled',this.bufferingHandler_);this.mediaElement_.removeEventListener('waiting',this.bufferingHandler_);var loadErrorCallback=function(){if(self.player_){self.resetMediaElement_();self.mediaElement_.dispatchEvent(new Event('error'))}};if(!this.preloadPlayer_||(this.preloadPlayer_.getHost&&this.preloadPlayer_.getHost().url!=url)){if(this.preloadPlayer_){this.preloadPlayer_.unload();this.preloadPlayer_=null}
console.log('Regular video load');var host=new cast.player.api.Host({'url':url,'mediaElement':this.mediaElement_});host.updateLicenseRequestInfo=function(requestInfo){console.log('updateLicenseRequestInfo --- requestInfo : '+JSON.stringify(requestInfo));requestInfo.headers={};requestInfo.headers.AUTHORIZATION='BASIC QWx0aWNhc3Q6RFJNU2VydmljZQ==';requestInfo.headers.host='sec.viettelttv.com.vn'};host.onError=loadErrorCallback;this.player_=new cast.player.api.Player(host);this.player_.load(protocolFunc(host))}else{console.log('Preloaded video load');this.player_=this.preloadPlayer_;this.preloadPlayer_=null;this.player_.getHost().onError=loadErrorCallback;this.player_.load();wasPreloaded=!0}}
this.loadMediaManagerInfo_(info,!!protocolFunc);return wasPreloaded};castReceiverPlayer.ChromecastPlayer.prototype.loadMediaManagerInfo_=function(info,loadOnlyTracksMetadata){if(loadOnlyTracksMetadata){this.maybeLoadSideLoadedTracksMetadata_(info)}else{this.loadDefault_(info)}};castReceiverPlayer.ChromecastPlayer.prototype.readSideLoadedTextTrackType_=function(info){if(!info.message||!info.message.media||!info.message.media.tracks){return}
for(var i=0;i<info.message.media.tracks.length;i++){var oldTextTrackType=this.textTrackType_;if(info.message.media.tracks[i].type!=cast.receiver.media.TrackType.TEXT){continue}
if(this.isTtmlTrack_(info.message.media.tracks[i])){this.textTrackType_=castReceiverPlayer.TextTrackType.SIDE_LOADED_TTML}else if(this.isVttTrack_(info.message.media.tracks[i])){this.textTrackType_=castReceiverPlayer.TextTrackType.SIDE_LOADED_VTT}else{console.log('Unsupported side loaded text track types');this.textTrackType_=castReceiverPlayer.TextTrackType.SIDE_LOADED_UNSUPPORTED;break}
if(oldTextTrackType&&oldTextTrackType!=this.textTrackType_){console.log('Load has inconsistent text track types');this.textTrackType_=castReceiverPlayer.TextTrackType.SIDE_LOADED_UNSUPPORTED;break}}};castReceiverPlayer.ChromecastPlayer.prototype.maybeLoadSideLoadedTracksMetadata_=function(info){if(!info.message||!info.message.media||!info.message.media.tracks||info.message.media.tracks.length==0){return}
var tracksInfo=({tracks:info.message.media.tracks,activeTrackIds:info.message.activeTrackIds,textTrackStyle:info.message.media.textTrackStyle});this.mediaManager_.loadTracksInfo(tracksInfo)};castReceiverPlayer.ChromecastPlayer.prototype.maybeLoadEmbeddedTracksMetadata_=function(info){if(!info.message||!info.message.media){return}
var tracksInfo=this.readInBandTracksInfo_();if(tracksInfo){this.textTrackType_=castReceiverPlayer.TextTrackType.EMBEDDED;tracksInfo.textTrackStyle=info.message.media.textTrackStyle;this.mediaManager_.loadTracksInfo(tracksInfo)}};castReceiverPlayer.ChromecastPlayer.prototype.processTtmlCues_=function(activeTrackIds,tracks){if(activeTrackIds.length==0){return}
for(var i=0;i<tracks.length;i++){var contains=!1;for(var j=0;j<activeTrackIds.length;j++){if(activeTrackIds[j]==tracks[i].trackId){contains=!0;break}}
if(!contains||!this.isTtmlTrack_(tracks[i])){continue}
if(!this.player_){var host=new cast.player.api.Host({'url':'','mediaElement':this.mediaElement_});host.updateLicenseRequestInfo=function(requestInfo){console.log('updateLicenseRequestInfo --- requestInfo : '+JSON.stringify(requestInfo));requestInfo.headers={};requestInfo.headers.AUTHORIZATION='BASIC QWx0aWNhc3Q6RFJNU2VydmljZQ==';requestInfo.headers.host='sec.viettelttv.com.vn'};this.protocol_=null;this.player_=new cast.player.api.Player(host)}
this.player_.enableCaptions(!0,cast.player.api.CaptionsType.TTML,tracks[i].trackContentId)}};castReceiverPlayer.ChromecastPlayer.prototype.isTtmlTrack_=function(track){return this.isKnownTextTrack_(track,castReceiverPlayer.TextTrackType.SIDE_LOADED_TTML,castReceiverPlayer.CaptionsMimeType.TTML)};castReceiverPlayer.ChromecastPlayer.prototype.isVttTrack_=function(track){return this.isKnownTextTrack_(track,castReceiverPlayer.TextTrackType.SIDE_LOADED_VTT,castReceiverPlayer.CaptionsMimeType.VTT)};castReceiverPlayer.ChromecastPlayer.prototype.isKnownTextTrack_=function(track,textTrackType,mimeType){if(!track){return!1}
var fileExtension=textTrackType;var trackContentId=track.trackContentId;var trackContentType=track.trackContentType;if((trackContentId&&castReceiverPlayer.getExtension_(trackContentId)===fileExtension)||(trackContentType&&trackContentType.indexOf(mimeType)===0)){return!0}
return!1};castReceiverPlayer.ChromecastPlayer.prototype.processInBandTracks_=function(activeTrackIds){var protocol=this.player_.getStreamingProtocol();var streamCount=protocol.getStreamCount();for(var i=0;i<streamCount;i++){var trackId=i+1;var isActive=!1;for(var j=0;j<activeTrackIds.length;j++){if(activeTrackIds[j]==trackId){isActive=!0;break}}
var wasActive=protocol.isStreamEnabled(i);if(isActive&&!wasActive){protocol.enableStream(i,!0)}else if(!isActive&&wasActive){protocol.enableStream(i,!1)}}};castReceiverPlayer.ChromecastPlayer.prototype.readInBandTracksInfo_=function(){var protocol=this.player_?this.player_.getStreamingProtocol():null;if(!protocol){return null}
var streamCount=protocol.getStreamCount();var activeTrackIds=[];var tracks=[];for(var i=0;i<streamCount;i++){var trackId=i+1;if(protocol.isStreamEnabled(i)){activeTrackIds.push(trackId)}
var streamInfo=protocol.getStreamInfo(i);var mimeType=streamInfo.mimeType;var track;if(mimeType.indexOf(castReceiverPlayer.TrackType.TEXT)===0||mimeType===castReceiverPlayer.CaptionsMimeType.TTML){track=new cast.receiver.media.Track(trackId,cast.receiver.media.TrackType.TEXT)}else if(mimeType.indexOf(castReceiverPlayer.TrackType.VIDEO)===0){track=new cast.receiver.media.Track(trackId,cast.receiver.media.TrackType.VIDEO)}else if(mimeType.indexOf(castReceiverPlayer.TrackType.AUDIO)===0){track=new cast.receiver.media.Track(trackId,cast.receiver.media.TrackType.AUDIO)}
if(track){track.name=streamInfo.name;track.language=streamInfo.language;track.trackContentType=streamInfo.mimeType;tracks.push(track)}}
if(tracks.length===0){return null}
var tracksInfo=({tracks:tracks,activeTrackIds:activeTrackIds});return tracksInfo};castReceiverPlayer.ChromecastPlayer.prototype.loadDefault_=function(info){this.onLoadOrig_(new cast.receiver.MediaManager.Event(cast.receiver.MediaManager.EventType.LOAD,(info.message),info.senderId))};castReceiverPlayer.ChromecastPlayer.prototype.setIdleTimeout_=function(t){console.log('setIdleTimeout_: '+t);var self=this;clearTimeout(this.idleTimerId_);if(t){this.idleTimerId_=setTimeout(function(){self.receiverManager_.stop()},t)}};castReceiverPlayer.ChromecastPlayer.prototype.setMediaType_=function(type,isLiveStream){console.log('setMediaType_: '+type);this.mediaType_=type;this.domElement_.setAttribute(domElementArtributeType,type);this.domElement_.setAttribute(domElementArtributeLive,isLiveStream.toString());var overlay=this.getElementByClass_(overlayClassName);var watermark=this.getElementByClass_(watermarkClassName);clearInterval(this.burnInPreventionIntervalId_);if(type!=castReceiverPlayer.Type.AUDIO){overlay.removeAttribute('style')}else{overlay.removeAttribute('style')}};castReceiverPlayer.ChromecastPlayer.prototype.setPlayerState_=function(state,opt_crossfade,opt_delay){console.log('setPlayerState_: state='+state+', crossfade='+opt_crossfade+', delay='+opt_delay);var self=this;self.lastStateTransitionTime_=Date.now();clearTimeout(self.delay_);if(opt_delay){var func=function(){self.setPlayerState_(state,opt_crossfade)};self.delay_=setTimeout(func,opt_delay)}else{if(!opt_crossfade){self.playerState_=state;self.domElement_.setAttribute(domElementArtributeState,state);self.updateApplicationState_();if(state!='PLAYING'){self.setIdleTimeout_(castReceiverPlayer.IDLE_TIMEOUT[state.toUpperCase()])}}else{var stateTransitionTime=self.lastStateTransitionTime_;castReceiverPlayer.transition_(self.domElement_,castReceiverPlayer.TRANSITION_DURATION_,function(){if(stateTransitionTime<self.lastStateTransitionTime_){console.log('discarded obsolete deferred state('+state+').');return}
self.setPlayerState_(state,!1)})}}};castReceiverPlayer.ChromecastPlayer.prototype.updateApplicationState_=function(){console.log('updateApplicationState_');if(this.mediaManager_){var idle=this.playerState_===castReceiverPlayer.State.IDLE;var media=idle?null:this.mediaManager_.getMediaInformation();var applicationState=castReceiverPlayer.getApplicationState_(media);if(this.curAppState_!=applicationState){this.curAppState_=applicationState;this.receiverManager_.setApplicationState(applicationState)}}};castReceiverPlayer.ChromecastPlayer.prototype.onBuffering_=function(){console.log('onBuffering[readyState='+this.mediaElement_.readyState+']');if(this.playerState_===castReceiverPlayer.State.PLAYING&&this.mediaElement_.readyState<HTMLMediaElement.HAVE_ENOUGH_DATA){this.setPlayerState_(castReceiverPlayer.State.BUFFERING,!1)}};castReceiverPlayer.ChromecastPlayer.prototype.cancelDeferredPlay_=function(cancelReason){if(this.deferredPlayCallbackId_){console.log('Cancelled deferred playback: '+cancelReason);clearTimeout(this.deferredPlayCallbackId_);this.deferredPlayCallbackId_=null}};castReceiverPlayer.ChromecastPlayer.prototype.deferPlay_=function(timeout){console.log('Defering playback for '+timeout+' ms');var self=this;this.deferredPlayCallbackId_=setTimeout(function(){self.deferredPlayCallbackId_=null;if(self.player_){console.log('Playing when enough data');self.player_.playWhenHaveEnoughData()}else{console.log('Playing');self.mediaElement_.play()}},timeout)};castReceiverPlayer.ChromecastPlayer.prototype.onLoadSuccess_=function(){console.log('onLoadSuccess');var totalTime=this.mediaElement_.duration;if(this.loadedMediaInfor_.data.media.streamType===cast.receiver.media.StreamType.LIVE){totalTime=this.loadedLiveDuration_}
if(!isNaN(totalTime)){this.totalTimeElement_.textContent=castReceiverPlayer.formatDuration_(totalTime)}else{this.totalTimeElement_.textContent='';this.progressBarInnerElement_.style.width='100%';this.progressBarThumbElement_.style.left='100%'}};castReceiverPlayer.getMediaImageUrl_=function(media){var metadata=media.metadata||{};var images=metadata.images||[];return images&&images[0]&&images[0].url};castReceiverPlayer.getProtocolFunction_=function(mediaInformation){var url=mediaInformation.contentId;var type=mediaInformation.contentType||'';var path=castReceiverPlayer.getPath_(url)||'';if(castReceiverPlayer.getExtension_(path)==='m3u8'||type==='application/x-mpegurl'||type==='application/vnd.apple.mpegurl'){return cast.player.api.CreateHlsStreamingProtocol}else if(castReceiverPlayer.getExtension_(path)==='mpd'||type==='application/dash+xml'){return cast.player.api.CreateDashStreamingProtocol}else if(path.indexOf('.ism')>-1||type==='application/vnd.ms-sstr+xml'){return cast.player.api.CreateSmoothStreamingProtocol}
return null};castReceiverPlayer.supportsPreload_=function(media){return castReceiverPlayer.getProtocolFunction_(media)!=null};castReceiverPlayer.canDisplayPreview_=function(media){var contentId=media.contentId||'';var contentUrlPath=castReceiverPlayer.getPath_(contentId);if(castReceiverPlayer.getExtension_(contentUrlPath)==='mp4'){return!0}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='ogv'){return!0}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='webm'){return!0}
return!1};castReceiverPlayer.getType_=function(media){var contentId=media.contentId||'';var contentType=media.contentType||'';var contentUrlPath=castReceiverPlayer.getPath_(contentId);if(contentType.indexOf('audio/')===0){return castReceiverPlayer.Type.AUDIO}else if(contentType.indexOf('video/')===0){return castReceiverPlayer.Type.VIDEO}else if(contentType.indexOf('application/x-mpegurl')===0){return castReceiverPlayer.Type.VIDEO}else if(contentType.indexOf('application/vnd.apple.mpegurl')===0){return castReceiverPlayer.Type.VIDEO}else if(contentType.indexOf('application/dash+xml')===0){return castReceiverPlayer.Type.VIDEO}else if(contentType.indexOf('application/vnd.ms-sstr+xml')===0){return castReceiverPlayer.Type.VIDEO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='mp3'){return castReceiverPlayer.Type.AUDIO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='oga'){return castReceiverPlayer.Type.AUDIO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='wav'){return castReceiverPlayer.Type.AUDIO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='mp4'){return castReceiverPlayer.Type.VIDEO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='ogv'){return castReceiverPlayer.Type.VIDEO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='webm'){return castReceiverPlayer.Type.VIDEO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='m3u8'){return castReceiverPlayer.Type.VIDEO}else if(castReceiverPlayer.getExtension_(contentUrlPath)==='mpd'){return castReceiverPlayer.Type.VIDEO}else if(contentType.indexOf('.ism')!=0){return castReceiverPlayer.Type.VIDEO}
return castReceiverPlayer.Type.UNKNOWN};castReceiverPlayer.transition_=function(element,time,cbfunction){if(time<=0||castReceiverPlayer.isCastForAudioDevice_()){cbfunction()}else{castReceiverPlayer.fadeOut_(element,time/2.0,function(){cbfunction();castReceiverPlayer.fadeIn_(element,time/2.0)})}};castReceiverPlayer.preload_=function(media,doneFunc){if(castReceiverPlayer.isCastForAudioDevice_()){doneFunc();return}
var imagesToPreload=[];var counter=0;var images=[];function imageLoaded(){if(++counter===imagesToPreload.length){doneFunc()}}
var thumbnailUrl=castReceiverPlayer.getMediaImageUrl_(media);if(thumbnailUrl){imagesToPreload.push(thumbnailUrl)}
if(imagesToPreload.length===0){doneFunc()}else{for(var i=0;i<imagesToPreload.length;i++){images[i]=new Image();images[i].src=imagesToPreload[i];images[i].onload=function(){imageLoaded()};images[i].onerror=function(){imageLoaded()}}}};castReceiverPlayer.isCastForAudioDevice_=function(){var receiverManager=window.cast.receiver.CastReceiverManager.getInstance();if(receiverManager){var deviceCapabilities=receiverManager.getDeviceCapabilities();if(deviceCapabilities){return deviceCapabilities.display_supported===!1}}
return!1};castReceiverPlayer.ChromecastPlayer.prototype.getElementByClass_=function(className){var element=this.domElement_.querySelector(className);if(element){return element}else{throw Error('Cannot find child element: className = '+className+' from this domElement: id =  '+this.domElement_.id+', className = '+this.domElement_.className)}};castReceiverPlayer.getPath_=function(url){var href=document.createElement('a');href.href=url;return href.pathname||''};castReceiverPlayer.setInnerText_=function(element,opt_text){if(!element){return}
element.innerText=opt_text||''};castReceiverPlayer.setText_=function(element,opt_text){if(!element){return}
element.innerHTML=opt_text||''};castReceiverPlayer.setBackgroundImage_=function(element,opt_url){if(!element){return}
element.style.backgroundImage=(opt_url?'url("'+opt_url.replace(/"/g,'\\"')+'")':'none');element.style.display=(opt_url?'':'none')};castReceiverPlayer.setImage_=function(element,opt_url){if(!element){return}
element.src=(opt_url?'url("'+opt_url.replace(/"/g,'\\"')+'")':'none');element.style.display=(opt_url?'':'none')};castReceiverPlayer.getExtension_=function(url){var parts=url.split('.');if(parts.length===1||(parts[0]===''&&parts.length===2)){return ''}
return parts.pop().toLowerCase()};castReceiverPlayer.fadeTo_=function(element,opacity,time,opt_doneFunc){var self=this;var id=Date.now();var listener=function(){element.style.webkitTransition='';element.removeEventListener('webkitTransitionEnd',listener,!1);if(opt_doneFunc){opt_doneFunc()}};element.addEventListener('webkitTransitionEnd',listener,!1);element.style.webkitTransition='opacity '+time+'s';element.style.opacity=opacity};castReceiverPlayer.fadeIn_=function(element,time,opt_doneFunc){castReceiverPlayer.fadeTo_(element,1,time,opt_doneFunc)};castReceiverPlayer.fadeOut_=function(element,time,opt_doneFunc){castReceiverPlayer.fadeTo_(element,0,time,opt_doneFunc)};castReceiverPlayer.addClassWithTimeout_=function(element,className,timeout){element.classList.add(className);return setTimeout(function(){element.classList.remove(className)},timeout)};castReceiverPlayer.ChromecastPlayer.prototype.updateProgress_=function(){if(!castReceiverPlayer.isCastForAudioDevice_()){var curTime=this.mediaElement_.currentTime;var totalTime=this.mediaElement_.duration;if(!isNaN(curTime)&&!isNaN(totalTime)){if(this.loadedMediaInfor_.data.media.streamType===cast.receiver.media.StreamType.LIVE){totalTime=this.loadedLiveDuration_}
var pct=100*(curTime/totalTime);this.curTimeElement_.innerText=castReceiverPlayer.formatDuration_(curTime);this.totalTimeElement_.innerText=castReceiverPlayer.formatDuration_(totalTime);this.progressBarInnerElement_.style.width=pct+'%';this.progressBarThumbElement_.style.left=pct+'%';if(this.displayPreviewMode_){this.previewModeTimerElement_.innerText=""+Math.round(totalTime-curTime)}}}};castReceiverPlayer.formatDuration_=function(dur){dur=Math.floor(dur);function digit(n){return('00'+Math.round(n)).slice(-2)}
var hr=Math.floor(dur/3600);var min=Math.floor(dur/60)%60;var sec=dur%60;if(!hr){return '00:'+digit(min)+':'+digit(sec)}else{return digit(hr)+':'+digit(min)+':'+digit(sec)}};/* (End) DOM and JS function*/